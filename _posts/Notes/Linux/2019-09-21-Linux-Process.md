---
layout: post
title: Linux进程管理
data: 2019-09-21
categories: Notes
tags: 
 - Linux
description:
excerpt_separator: ""
---

# 什么是进程

进程用来表示正在运行的程序。在Linux内核中维护着一张表，记录了当前系统中运行的所以进程的各种信息。内核中一些重要的进程的信息如下：

| 进程的内存地址         |
| ---------------------- |
| 进程当前的状态         |
| 进程正在使用的资源     |
| 进程的优先级（谦让度） |
| 进程的属主             |

# 进程的属性

一个进程包含了多个属性参数，决定了进程被处理的先后顺序、能够访问的资源等。下面介绍几个常用参数。

## PID：进程的ID号

Linux使用进程的唯一ID来标示进程，称作PID。同样用户与系统进行交互时也使用PID，而不是进程名。

## PPID：父进程的ID

除了在系统引导时由内核自主创建并安装的那几个进程，Linux中所有的进程都必须由另一个进程创建。这样就出现了父进程的概念，使用PPID来表示。

## UID和EUID：真实和有效的用户ID

只有进程的创建者和root用户才可以对进程进行操作，Linux使用UID来标示进程的创建者。

Linux还为进程保存了一个“有效用户ID”，称作EUID，用来表示进程对于文件和资源的访问权限。

## GID和EGID：真实和有效的组ID

与UID和EUID类似的还有GID和EGID，分别表示真实组ID和有效组ID。

## 谦让度和优先级

进程的优先级决定了其收到CPU“有优待”的程度。优先级高的进程能够被更早地处理，并获得更多的处理器时间。Linux内核会综合考虑一个进程的各种因素来决定其优先级，包括进程已经消耗的CPU时间、进程已经等待的时间等。在绝大多数情况下，决定进程何时被处理是内核的事情，不需要用户插手。

用户可以设置进程的“谦让度”来影响内核的决定。顾名思义，谦让度高往往会获得更高的优先级。

# 监视进程：ps命令

使用ps命令来监视系统进程。如下命令将显示当前系统上运行的所有进程的信息。

```bash
ps aux
```

ps命令将返回一个表格，以下是表格的表头字段和具体含义：

| 字段    | 含义                                               |
| ------- | -------------------------------------------------- |
| USER    | 进程的创建者                                       |
| PID     | 进程的ID                                           |
| %CPU    | 进程的CPU占用率                                    |
| %MEM    | 进程的内存占用率                                   |
| VSZ     | 进程占用的训内存大小                               |
| RSS     | 内存中页的数量（页是管理内存的单位，PC上通常为4K） |
| TTY     | 进程所在终端的ID                                   |
| STAT    | 进程的状态                                         |
| START   | 进程启动的时间                                     |
| TIME    | 进程已占用的CPU时间                                |
| COMMAND | 命令和参数                                         |

以下是STAT字段支持的参数：

| 参数 | 含义                                       |
| ---- | ------------------------------------------ |
| R    | 正在运行/可运行                            |
| D    | 睡眠中（不可被唤醒，通常是在等待I/O设备）  |
| S    | 睡眠中（可被唤醒）                         |
| T    | 停止（由于收到信号或被跟踪）               |
| Z    | 僵进程（已经结束而没有释放系统资源的进程） |

以下是STAT字段支持的附加标志：

| 附加标志 | 含义                           |
| -------- | ------------------------------ |
| <        | 进程拥有比普通优先级高的优先级 |
| N        | 进程拥有比普通优先级低的优先级 |
| L        | 有些页面被锁在内存中           |
| s        | 会话的先导进程                 |

ps命令的另一组选项lau可以提供父进程ID（PPID）和谦让度（NI）。

# 即时跟踪进程信息：top命令

ps命令可以一次性给出当前系统中进程信息的快照，但这样缺乏时效性。管理员可能要通过不停使用ps命令来更新信息。Linux提供了top命令用于即时跟踪系统中的进程情况。

以下命令会即时显示系统进程信息。

```bash
top
```

top命令的返回信息会占满一页，并即时更新，依据CPU的使用率排序。可使用命令q退出程序。

# 查看占用文件的进程：lsof命令

可以使用lsof命令来查看占用某个文件的进程。以下命令将显示占用了foo.txt文件的进程的信息。

```bash
lsof foo.txt
```

# 向进程发送信号：kill命令

使用kill命令可杀死指定进程。如下命令将会终止PID为1234的进程。

```bash
kill 1234
```

kill命令不只可被用于杀死进程，实际上它是一条用于和进程通讯的命令，它可以接受很多参数。实例`kill -l`来查看其具体接受的参数。

`kill 1234`命令等同于`kill -TERM 1234`或者`kill -SIGTERM 1234`。

# 调整进程的谦让度：nice和renice命令

使用nice命令可以某一指定谦让度启动一个进程。如下命令会启动foo进程，并将其谦让度增量设为2。

```bash
nice -n 2 foo
```

-n参数用于设置谦让度增量。

也可以使用renice命令来调整已运行进程的谦让度。下面命令会将PID为1234的进程的谦让度调整为12。

```bash
renice +12 -p 1234
```

-p参数用于接受进程ID。进程的谦让度继承自父进程，由此引伸出了谦让度增量的概念。进程的属主可以自由提高进程的谦让度，但若想降低谦让度则需要root权限。
